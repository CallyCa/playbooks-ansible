---
- name: Install Kubectl {{ kubectl_version }}
  block:
    - name: Download and install Kubectl {{ kubectl_version }}
      become: true
      ansible.builtin.get_url:
        url: "https://dl.k8s.io/release/v{{ kubectl_version }}/bin/linux/amd64/kubectl"
        dest: /usr/local/bin/kubectl
        mode: "0755"

    - name: Download Kubectx and Kubens
      become: true
      ansible.builtin.git:
        repo: "https://github.com/ahmetb/kubectx/"
        version: "{{ kubectx_version }}"
        dest: /opt/kubectx

    - name: Create symlink for kubectx and kubens
      become: true
      ansible.builtin.file:
        src: "/opt/kubectx/{{ item }}"
        dest: "/usr/local/bin/{{ item }}"
        state: link
      with_items:
        - kubectx
        - kubens

- name: Verify Kubectl installation
  ansible.builtin.command: kubectl version --client
  register: kubectl_version_check

- name: Display Kubectl version
  debug:
    var: kubectl_version_check.stdout
